<script>
  const WEB_APP_URL = "PASTE_URL_WEB_APP_DISINI";

  function startScanner(cameraId) {
    const qr = new Html5Qrcode("reader");
    qr.start(
      cameraId,
      { fps: 10, qrbox: 250 },
      (decodedText) => {
        document.getElementById("status").innerText = "✅ Terdeteksi: " + decodedText;
        fetch(WEB_APP_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ studentId: decodedText, token: "ABSEN2025-KEY" })
        })
        .then(r => r.json())
        .then(res => {
          if (res.success) {
            document.getElementById("status").innerText = "✔ Absensi berhasil: " + decodedText;
          } else {
            document.getElementById("status").innerText = "⚠ Error: " + res.error;
          }
        })
        .catch(err => {
          document.getElementById("status").innerText = "❌ Gagal koneksi: " + err;
        });
      },
      (err) => {
        console.log("Scan error:", err);
      }
    ).catch(err => {
      document.getElementById("status").innerText = "❌ Tidak bisa mulai kamera: " + err;
      console.error("Start error:", err);
    });
  }

  Html5Qrcode.getCameras().then(devices => {
    console.log("Daftar kamera:", devices);
    if (devices && devices.length) {
      let backCam = devices.find(d => d.label.toLowerCase().includes('back')) || devices[0];
      startScanner(backCam.id);
    } else {
      document.getElementById("status").innerText = "❌ Kamera tidak ditemukan";
    }
  }).catch(err => {
    document.getElementById("status").innerText = "❌ Error akses kamera: " + err;
    console.error("Camera error:", err);
  });
</script>
