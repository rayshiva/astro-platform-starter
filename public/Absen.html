<script>
  const WEB_APP_URL = "PASTE_URL_WEB_APP_DISINI"; // Ganti dengan URL Web App

  function startScanner(cameraId) {
    const html5QrCode = new Html5Qrcode("reader");
    html5QrCode.start(
      cameraId,
      {
        fps: 10,
        qrbox: 250
      },
      (decodedText, decodedResult) => {
        document.getElementById("status").innerText = "ID Terdeteksi: " + decodedText + " | Mengirim...";

        fetch(WEB_APP_URL, {
          method: "POST",
          body: JSON.stringify({ id: decodedText }),
          headers: { "Content-Type": "application/json" }
        })
        .then(res => res.json())
        .then(data => {
          document.getElementById("status").innerText = "✅ Absensi berhasil: " + decodedText;
          html5QrCode.stop();
        })
        .catch(err => {
          document.getElementById("status").innerText = "❌ Gagal mencatat absensi";
        });
      },
      (errorMessage) => {
        console.log("Scan error: " + errorMessage);
      }
    );
  }

  // Cek daftar kamera
  Html5Qrcode.getCameras().then(devices => {
    if (devices && devices.length) {
      // pilih kamera belakang kalau ada
      let backCamera = devices.find(d => d.label.toLowerCase().includes('back')) || devices[0];
      startScanner(backCamera.id);
    } else {
      document.getElementById("status").innerText = "❌ Kamera tidak ditemukan";
    }
  }).catch(err => {
    document.getElementById("status").innerText = "❌ Error akses kamera: " + err;
  });
</script>
